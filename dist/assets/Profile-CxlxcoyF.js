import{a as y,r as h,j as e,y as d,e as v}from"./index-C1C7CAEQ.js";import{u as N}from"./useQuery-CyVCY3EZ.js";import{u as w}from"./useMutation-1ScYOpKK.js";import{G as k}from"./iconBase-Bd1mD37r.js";import{a as E}from"./index-0U5k7MBs.js";import{a as U}from"./index-DKYPNg8G.js";import{p as F,q as _,t as P,v as R}from"./api-CJ7_z0NO.js";import{g as z,A as I}from"./Avatar-ev3lOT99.js";import{f as M}from"./time-VhdYBW02.js";function q(l){return k({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M7 7h-1a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-1"},child:[]},{tag:"path",attr:{d:"M20.385 6.585a2.1 2.1 0 0 0 -2.97 -2.97l-8.415 8.385v3h3l8.385 -8.415z"},child:[]},{tag:"path",attr:{d:"M16 5l3 3"},child:[]}]})(l)}const B=({user:l,close:c})=>{const{setUser:a}=y(),[r,p]=h.useState({userName:l.userName,email:l.email,password:"",confirmPassword:""}),t=i=>{i.target.id==="profileBox"&&c()},{mutate:g,data:j,isPending:x}=w({mutationFn:F}),u=i=>{if(i.preventDefault(),(r==null?void 0:r.password.trim())!==r.confirmPassword.trim()){d.error("Password mismatch!");return}g(r,{onSuccess:o=>{a(o==null?void 0:o.user),d.success(o==null?void 0:o.message),c()}})},m=i=>{const{name:o,value:f}=i.target;p(s=>({...s,[o]:f}))};return e.jsx("div",{id:"profileBox",onClick:t,className:" backdrop-blur-sm z-20 md:max-h-screen  inset-0 absolute ",children:e.jsxs("div",{className:"absolute backdrop-blur-lg p-7 max-w-screen-md bg-gray-800  mx-auto blur-none  w-2/3 top-[50%] left-[50%] -translate-x-[50%] -translate-y-[50%] rounded-lg",children:[e.jsxs("h1",{className:"font-mono  text-2xl font-bold text-center mb-6  w-fit mx-auto px-2 py-1",children:["Update profile"," "]}),e.jsxs("form",{onSubmit:u,className:"flex flex-col sm:grid sm:grid-cols-2 gap-2 gap-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{htmlFor:"userName",children:"User name"}),e.jsx("input",{id:"userName",type:"text",name:"userName",className:"bg-gray-700 font-serif p-1 border-2 text-sm border-gray-600 rounded-md",value:r==null?void 0:r.userName,onChange:m})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{htmlFor:"email",children:"E-mail"}),e.jsx("input",{id:"email",type:"text",name:"email",className:"bg-gray-700 font-serif  p-1 border-2 text-sm border-gray-600 rounded-md",value:r==null?void 0:r.email,onChange:m})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{htmlFor:"password",children:"Password"}),e.jsx("input",{id:"password",type:"text",name:"password",className:"bg-gray-700 font-serif  p-1 border-2 text-sm border-gray-600 rounded-md",value:r==null?void 0:r.password,onChange:m})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{htmlFor:"confirmPassword",children:"Re-enter password"}),e.jsx("input",{id:"confirmPassword",type:"text",name:"confirmPassword",className:"bg-gray-700 font-serif  p-1 border-2 text-sm border-gray-600 rounded-md",value:r==null?void 0:r.confirmPassword,onChange:m})]}),e.jsx("button",{type:"submit",disabled:x,className:"w-fit mx-auto rounded-md font-semibold border-green-600 text-green-500 col-span-2 px-3  py-2 border-2",children:x?"Updating...":"Update"})]})]})})};function D(l){return k({tag:"svg",attr:{version:"1",viewBox:"0 0 48 48",enableBackground:"new 0 0 48 48"},child:[{tag:"path",attr:{fill:"#F44336",d:"M34,9c-4.2,0-7.9,2.1-10,5.4C21.9,11.1,18.2,9,14,9C7.4,9,2,14.4,2,21c0,11.9,22,24,22,24s22-12,22-24 C46,14.4,40.6,9,34,9z"},child:[]}]})(l)}const $=()=>{const[l,c]=h.useState(!1),{user:a,setUser:r}=y(),p=h.useRef(null),{data:t,isLoading:g,isError:j,error:x}=N({queryKey:["profile-data"],queryFn:()=>P()});N({queryKey:["getEvents"],queryFn:()=>R(a._id)});const{mutate:u,isPending:m}=w({mutationFn:_,onSuccess:s=>{r(s==null?void 0:s.user),d.success(s==null?void 0:s.message)},onError:s=>{d.error(s)}}),i=v(),o=s=>{s.preventDefault();const n=s.target.files[0];if(r(C=>({...C,profile_image_url:n})),!n)return;const b=new FormData;b.append("image",n),u(b)},f=()=>{p.current.click()};return j&&d.error("Error fetching data"),z(a.userName),e.jsxs("div",{className:"p-2  font-roboto  mx-auto select-none",children:[e.jsxs("section",{className:"  flex flex-col sm:flex-row gap-2 ",children:[e.jsxs("div",{className:" sm:w-[300px] h-[250px] rounded-md flex flex-col justify-around text-center relative p-4 bg-slate-800",children:[e.jsxs("div",{title:"upload",onClick:f,className:"flex relative cursor-pointer transition-opacity duration-300 group justify-center uppercase  items-center rounded-full  border-2 mx-auto",children:[e.jsx(I,{size:"xl",imageUrl:a==null?void 0:a.profile_image_url,name:a==null?void 0:a.userName}),e.jsx("div",{className:"absolute inset-0 cursor-pointer bg-black bg-opacity-50 flex items-center justify-center rounded-full opacity-0 group-hover:opacity-100 ",children:e.jsx(E,{className:"text-white w-8 h-8"})}),e.jsx("input",{type:"file",ref:p,onChange:o,className:"hidden "})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"cursor-pointer",children:[a==null?void 0:a.userName," "]}),e.jsx("p",{className:"opacity-70",children:a==null?void 0:a.email})]}),e.jsx("div",{className:"absolute top-2 right-2",onClick:()=>c(!0),title:"Edit",children:e.jsx(q,{className:"cursor-pointer text-xl text-green-500"})})]}),e.jsxs("div",{className:" border-2 sm:w-[80%] pl-2 sm:pl-5 pt-2 sm:pt-3 rounded-md",children:[e.jsx("h3",{children:"Events"}),e.jsxs("div",{className:" font-mono",children:[e.jsxs("p",{children:["Events Created: ",t==null?void 0:t.eventsCreated," "]}),e.jsxs("p",{children:["Events participated: ",t==null?void 0:t.eventsParticipated]})]})]})]}),e.jsxs("section",{className:" rounded-md mt-3 p-2 space-y-5 bg-zinc-800 ",children:[e.jsx("h3",{className:"font-mono font-bold",children:"Most liked events"}),e.jsx("div",{className:"flex flex-col gap-7 sm:flex-row justify-around pb-5 font-mono",children:t==null?void 0:t.most_liked_events.slice(0,3).map(s=>{var n;return e.jsxs("div",{onClick:()=>{i(`/events/${s==null?void 0:s._id}`)},className:" mx-auto w-4/5 sm:w-[220px] h-[230px] p-2 cursor-pointer rounded-md bg-slate-500 flex flex-col",children:[e.jsx("img",{className:"rounded-md w-4/5 sm:w-[200px] mx-auto h-[160px] object-cover",src:s==null?void 0:s.imageUrl,alt:s==null?void 0:s.title}),e.jsxs("p",{className:"text-[12px]] p-1 line-clamp-1",children:[e.jsx(U,{className:"inline text-blue-700 mr-1"}),s==null?void 0:s.title]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx(D,{size:20,className:"inline mx-1 text-red-600"}),(n=s==null?void 0:s.likes)==null?void 0:n.length]}),e.jsx("p",{className:" text-sm text-black",children:M(s==null?void 0:s.createdAt)})]})]},s==null?void 0:s._id)})})]}),l&&e.jsx(B,{user:a,close:()=>c(!1)})]})};export{$ as default};
