import{j as s,u as f,r as o,a as d,e as p}from"./index-C1C7CAEQ.js";import{f as h}from"./time-VhdYBW02.js";import{A as g}from"./Avatar-ev3lOT99.js";import{e as m,h as j}from"./api-CJ7_z0NO.js";import{u as b}from"./useQuery-CyVCY3EZ.js";import{u as N}from"./useMutation-1ScYOpKK.js";const y=({comment:e})=>{var r,a,i;return s.jsx("div",{className:"flex space-x-4 p-4  bg-zinc-800 w-full font-poppins rounded-lg  ",children:s.jsxs("div",{className:"flex flex-col w-full",children:[s.jsxs("div",{className:"flex  w-full items-center space-x-2 justify-between",children:[s.jsxs("span",{className:"font-semibold text-white flex items-center space-x-2 gap-2 ",children:[s.jsx(g,{size:"sm",imageUrl:(r=e==null?void 0:e.user)==null?void 0:r.profile_image_url,name:(a=e==null?void 0:e.user)==null?void 0:a.userName}),(i=e==null?void 0:e.user)==null?void 0:i.userName]}),s.jsx("span",{className:"text-sm text-gray-300",children:h(e==null?void 0:e.createdAt)})]}),s.jsx("p",{className:"mt-2 text-gray-200",children:e==null?void 0:e.comment})]})},e==null?void 0:e._id)},w=({eventId:e})=>{const{isLoading:r,error:a,isError:i,data:t}=b({queryKey:["comments",e],queryFn:()=>m(e),enabled:!!e});return s.jsx("div",{className:"flex flex-col bg-zinc-900 rounded-lg gap-2 py-2",children:r?s.jsx("p",{children:"Loading comments..."}):i?s.jsx("p",{children:"Error loading comments"}):(t==null?void 0:t.length)===0?s.jsx("p",{className:"text-gray-500",children:"No comments yet. Be the first to comment!"}):t.map(l=>s.jsx(y,{comment:l},l==null?void 0:l._id))})},C=({eventId:e})=>{const r=f(),[a,i]=o.useState(""),{user:t}=d(),l=p();o.useEffect(()=>{t||l("/login")},[t]);const{isPending:u,mutate:x}=N({mutationFn:j,onSuccess:()=>{r.invalidateQueries(["comments",e]),i("")}}),c=n=>{if(n.preventDefault(),!t){l("/login");return}a.trim()&&x({comment:a,user:t==null?void 0:t._id,event:e})};return s.jsxs("form",{onSubmit:c,className:"bg-zinc-800 p-4 rounded-lg shadow-md w-full mx-auto font-poppins flex flex-col justify-end items-end",children:[s.jsx("textarea",{value:a,onChange:n=>i(n.target.value),placeholder:"Write your comment here...",rows:"3",className:"w-full p-2 border border-zinc-500 text-zinc-100 bg-zinc-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4 max-h-[90px] min-h-[90px] "}),s.jsx("button",{type:"submit",className:"w-fit p-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition duration-200",disabled:u,children:u?"Adding...":"Add Comment"})]})},S=({eventId:e})=>{const{user:r}=d();return s.jsxs("div",{className:"w-full mx-auto mt-5 bg-zinc-900 rounded-lg p-2",children:[s.jsx("h2",{className:"text-xl font-semibold mb-4 text-white text-center h-10 items-center flex justify-center",children:"Comments"}),r?s.jsx(C,{eventId:e}):s.jsx("div",{className:"w-full text-white p-2",children:s.jsx("p",{children:"login to share your thoughts"})}),s.jsx(w,{eventId:e})]})};export{S as default};
